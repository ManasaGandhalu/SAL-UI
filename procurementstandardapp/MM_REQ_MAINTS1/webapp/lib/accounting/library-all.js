jQuery.sap.declare('sap.ui.s2p.mm.lib.reuse.accounting.library-all');if(!jQuery.sap.isDeclared('sap.ui.s2p.mm.lib.reuse.accounting.component.Component')){jQuery.sap.declare('sap.ui.s2p.mm.lib.reuse.accounting.component.Component');
/*
 * Copyright (C) 2009-2017 SAP SE or an SAP affiliate company. All rights reserved.
 */
jQuery.sap.require('sap.ui.core.Control');sap.ui.core.UIComponent.extend("sap.ui.s2p.mm.lib.reuse.accounting.component.Component",{metadata:{manifest:"json",publicMethods:["updateAccList"],properties:{sAccEntitySetName:"string",sAccEntityTypeName:"string",sAccBindingPathEntityType:"string",sAccBindingPathEntitySet:"string",oModel:"object",bEditMode:"boolean",bAccDetailsAsPopup:"boolean",sCurrentView:"string",bShowListHeader:"boolean"},dependencies:{libs:["sap.m","sap.ui.s2p.mm.lib.reuse.accounting"],components:["sap.ui.s2p.mm.lib.reuse.accounting.component"]},events:{detailNavigation:{},listNavigation:{}}},createContent:function(){if(this.oComponentData.sCurrentView==="list"){this.page=new sap.ui.view({viewName:"sap.ui.s2p.mm.lib.reuse.accounting.component.view.AccountAssignment",type:sap.ui.core.mvc.ViewType.XML});this._setShowHeader(this.oComponentData.bShowListHeader);}else{this.page=new sap.ui.view({viewName:"sap.ui.s2p.mm.lib.reuse.accounting.component.view.AccountAssignmentDetail",type:sap.ui.core.mvc.ViewType.XML});}this._setPopDisplay(this.oComponentData.bAccDetailsAsPopup);this._setEditMode(this.oComponentData.bEditMode);return this.page;},_setPopDisplay:function(m){this.page.getController()._setPopDisplay(m);},_setEditMode:function(m){this.page.getController()._setEditMode(m);},_setShowHeader:function(m){this.page.getController()._setShowHeader(m);},updateAccList:function(s,e,p){this.page.getController().updateAccList(s,e,p);}});};if(!jQuery.sap.isDeclared('sap.ui.s2p.mm.lib.reuse.accounting.component.util.HelperFunctions')){jQuery.sap.declare('sap.ui.s2p.mm.lib.reuse.accounting.component.util.HelperFunctions');sap.ui.define("sap/ui/s2p/mm/lib/reuse/accounting/component/util/HelperFunctions",function(){"use strict";var H={setLayoutProperties:function(v){this.oSmartForm=v.byId("accAssignSmartForm");if(!this.oSmartForm){this.oSmartForm=sap.ui.getCore().byId("accAssignSmartForm");}var u;if(u===true){this.oSmartForm.setUseHorizontalLayout(true);if(v.byId("AccGroup")){v.byId("AccGroup").setUseHorizontalLayout(true);}}else{this.oSmartForm.setUseHorizontalLayout(false);}this.oSmartForm.setEditable(true);},getAttributesFromMetadata:function(m,a){var e=m.getServiceMetadata().dataServices.schema[0].entityType;for(var i=0;i<e.length;i++){if(e[i].name===a){return e[i].property;}}},getAccAssignAnnotationFromMetadata:function(m,a,g){var d;var A=m.getServiceMetadata().dataServices.schema[0].annotations;var e=[];for(var i=0;i<A.length;i++){if(A[i].target.indexOf(a)>-1){for(var j=0;j<A[i].annotation.length;j++){if(A[i].annotation[j].extensions&&A[i].annotation[j].extensions[0].name==="Qualifier"&&A[i].annotation[j].extensions[0].value===g){for(var k=0;k<A[i].annotation[j].record.propertyValue.length;k++){if(A[i].annotation[j].record.propertyValue[k].property==="Data"){d=A[i].annotation[j].record.propertyValue[k].collection.record;return d;}}}}}}if(!d){A=m.getServiceAnnotations();var E={};var b=a;for(var p in A){if(p.search(b)!==-1){E=A[p];break;}}for(var c in E){if(((c.search("FieldGroup")!==-1)&&(c.search(g)!==-1))||(c.search("Identification")!==-1)){if(E[c].Data){e.push(E[c].Data);}}}return e;}},getKeyFromPath:function(p){var k=[];var t=p.split("(");t=t[1].split(")");var K=t[0].split(",");for(var i=0;i<K.length;i++){t=K[i].split("=");var s=String(t[0]);var a=String(t[1].replace("'","").replace("'",""));k.push([s,a]);}return k;},getUrlParametersFromKeyArray:function(k){var u='{';for(var i=0;i<k.length;i++){u=u+'"'+k[i][0]+'" : "'+k[i][1]+'"';if(i<k.length-1){u=u+',';}else{u=u+'}';}}return JSON.parse(u);},getKeyStringFromKeyJSON:function(k){var K=[];for(var e in k){K.push([e,k[e]]);}var v=K[0][0]+"='"+K[0][1]+"'";for(var i=1;i<K.length;i++){v=v+","+K[i][0]+"='"+K[i][1]+"'";}return v;},replaceAll:function(t,r){return this.split(t).join(r);},containsVisibleAttribute:function(g){var G=g.getGroupElements();for(var i=0;i<G.length;i++){if(G[i].getVisible()){return true;}}return false;},clearAttributes:function(g){if(g&&g.getGroupElements().length>0){g.destroyGroupElements();}}};return H;},true);};if(!jQuery.sap.isDeclared('sap.ui.s2p.mm.lib.reuse.accounting.controls.ExampleRenderer')){jQuery.sap.declare('sap.ui.s2p.mm.lib.reuse.accounting.controls.ExampleRenderer');jQuery.sap.require('jquery.sap.global');sap.ui.define("sap/ui/s2p/mm/lib/reuse/accounting/controls/ExampleRenderer",['jquery.sap.global'],function(q){"use strict";var E={};E.render=function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapRULTExample");r.writeClasses();r.write(">");r.writeEscaped(c.getText());r.write("</div>");};return E;},true);};if(!jQuery.sap.isDeclared('sap.ui.s2p.mm.lib.reuse.accounting.library')){jQuery.sap.declare('sap.ui.s2p.mm.lib.reuse.accounting.library');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.library');sap.ui.define("sap/ui/s2p/mm/lib/reuse/accounting/library",["jquery.sap.global","sap/ui/core/library"],function(q){"use strict";sap.ui.getCore().initLibrary({name:"sap.ui.s2p.mm.lib.reuse.accounting",version:"4.0.9",dependencies:["sap.ui.core"],types:[],interfaces:[],controls:[],elements:[]});return sap.ui.s2p.mm.lib.reuse.accounting;},true);};if(!jQuery.sap.isDeclared('sap.ui.s2p.mm.lib.reuse.accounting.component.controller.AccountAssignment.controller')){jQuery.sap.declare('sap.ui.s2p.mm.lib.reuse.accounting.component.controller.AccountAssignment.controller');jQuery.sap.require('sap.ui.core.mvc.Controller');jQuery.sap.require('sap.m.Dialog');sap.ui.define("sap/ui/s2p/mm/lib/reuse/accounting/component/controller/AccountAssignment.controller",["sap/ui/core/mvc/Controller","sap/m/Dialog","sap/ui/s2p/mm/lib/reuse/accounting/component/util/HelperFunctions"],function(C,D){"use strict";return C.extend("sap.ui.s2p.mm.lib.reuse.accounting.component.controller.AccountAssignment",{onInit:function(){this.oi18nModel=new sap.ui.model.resource.ResourceModel({bundleName:"sap.ui.s2p.mm.lib.reuse.accounting.messagebundle",bundleLocale:sap.ui.getCore().getConfiguration().getFormatLocale()});this.getView().setModel(this.oi18nModel,"i18n");this.oTextBundle=this.oi18nModel.getResourceBundle();this.accAssignMetadata=[[],[]];this.bAccDetailsAsPopup=null;this.EditMode=null;this.ShowHeader=null;this.oDialog=null;this.sAccEntitySetName=this.getOwnerComponent().oComponentData.sAccEntitySetName;this.sAccTableBindingPath=this.getOwnerComponent().oComponentData.sAccBindingPathEntitySet;this.oModel="";if(this.getOwnerComponent().oComponentData.oModel){this.oModel=this.getOwnerComponent().oComponentData.oModel;}else{this.oModel=this.getView().getModel();}},_setDetailsButtonVisibility:function(v){this.getView().byId("detailsButton").setVisible(v);},_showNavigationButton:function(){this.getView().byId("accountColumn").setType("Navigation");},_showListCRUDActions:function(){this.getView().byId("addButton").setEnabled(this.EditMode);this.getView().byId("deleteButton").setEnabled(this.EditMode);},_showListHeader:function(){if(this.ShowHeader){this.getView().byId("accBasicTable").setHeader(this.oTextBundle.getText("header"));this.getView().byId("accBasicTable").setShowRowCount(true);}},onUpdateFinished:function(){this.getView().byId("accountingTable").getItems()[0].setSelected(true);},onBeforeRendering:function(){if(this.bAccDetailsAsPopup===true){this._setDetailsButtonVisibility(true);}if(this.bAccDetailsAsPopup===false){this._showNavigationButton();this._setDetailsButtonVisibility(false);}this._showListCRUDActions();this._showListHeader();this.getView().byId("accBasicTable").setEditable(this.EditMode);},_setPopDisplay:function(m){this.bAccDetailsAsPopup=m;},_setEditMode:function(m){this.EditMode=m;},_setShowHeader:function(m){this.ShowHeader=m;},onAfterRendering:function(){this.getView().setModel(this.oModel);this.getView().byId("accBasicTable").setModel(this.oModel);this.getView().byId("accBasicTable").setEntitySet(this.sAccEntitySetName);this.getView().byId("accBasicTable").setTableBindingPath(this.sAccTableBindingPath);this.getView().byId("accBasicTable").setEditable(this.EditMode);},onDetail:function(){var l=this.getView().byId("accountingTable").getSelectedContexts();if(l.length>0){this.bindingPath=this.getView().byId("accountingTable").getSelectedContexts()[0].getPath();this.page=new sap.ui.view({viewName:"sap.ui.s2p.mm.lib.reuse.accounting.component.view.AccountAssignmentDetail",type:sap.ui.core.mvc.ViewType.XML});var t=this;this.oDialog=new D({title:this.oTextBundle.getText("accAssignTitle"),content:this.page,beginButton:new sap.m.Button({text:"Close",press:function(){t.oDialog.close();}})});this.getView().addDependent(this.oDialog);this.page.getController().setContextPath(this.bindingPath);this.page.getController()._setEditMode(this.EditMode);this.page.getController().setOwnerData(this.getOwnerComponent().oComponentData);this.oModel.read(this.bindingPath,{success:jQuery.proxy(this.onRead,this)});}else{sap.m.MessageToast.show(this.oTextBundle.getText("accErrorMessage"));}},onRead:function(){this.oDialog.open();},onLineItemPressed:function(e){var l=this.getView().byId("accountingTable").getSelectedContexts();if(l.length>0){var p=this.getView().byId("accountingTable").getSelectedContexts()[0].getPath();this.getOwnerComponent().fireEvent("detailNavigation",{detailEvent:e,bindpath:p});}else{sap.m.MessageToast.show(this.oTextBundle.getText("accErrorMessage"));}},onCloseDialog:function(){this._oDialog.close();},onCreate:function(e){var E=e;var u=this.sAccTableBindingPath;var d={Quantity:"0.000"};this.oModel.create(u,d,{success:jQuery.proxy(this.successHandlerCreate,this,E),error:jQuery.proxy(this.errorHandlerCreate,this)});},successHandlerCreate:function(e,r){var l=r.__metadata.uri;var a=l.split("/");this.bindingPath="/"+a[a.length-1];if(this.bAccDetailsAsPopup===true){this.onDetailAfterCreate(this.bindingPath);}if(this.bAccDetailsAsPopup===false){this.onLineItemPressedAfterCreate(e,this.bindingPath);}this.getView().byId("accountingTable").getModel().refresh();},onDetailAfterCreate:function(b){this.bindingPath=b;this.page=new sap.ui.view({viewName:"sap.ui.s2p.mm.lib.reuse.accounting.component.view.AccountAssignmentDetail",type:sap.ui.core.mvc.ViewType.XML});var d=new D({content:this.page,beginButton:new sap.m.Button({text:"Close",press:function(){d.close();}})});this.getView().addDependent(d);this.page.getController().setContextPath(this.bindingPath);this.page.getController()._setEditMode(this.EditMode);this.page.getController().setOwnerData(this.getOwnerComponent().oComponentData);d.open();},onLineItemPressedAfterCreate:function(e,b){var p=b;this.getOwnerComponent().fireEvent("detailNavigation",{detailEvent:e,bindpath:p});},onDelete:function(){var b=this.getView().byId("accountingTable").getSelectedContexts()[0].getPath();this.oModel.remove(b,{batchGroupId:1,changeSetId:1,success:jQuery.proxy(this.successHandlerDelete,this)});},successHandlerDelete:function(){var s=this.oTextBundle.getText("msg_success_delete");sap.m.MessageToast.show(s,{duration:2000});this.oModel.refresh();},updateAccList:function(s,a,p){var m=this.oModel;var b=[];var o=[];for(var c in m.oData){if(c.indexOf(this.sAccEntitySetName)>=0){b.push(c);}}for(var i=0;i<b.length;i++){var d=m.getData("/"+b[i]);var f;try{if(d.hasOwnProperty('HasDraftEntity')){delete d.HasDraftEntity;}delete d.DraftAdministrativeDataUUID;delete d.IsActiveEntity;delete d.HasActiveEntity;delete d.MultipleAcctAssgmtDistrPercent;delete d.CompanyCode;delete d.CostElement;delete d.PurReqnAcctDraftUUID;delete d.PurReqnDraftUUID;delete d.PurReqnItemDraftUUID;for(f in d)if(typeof(d[f])==="object"){delete d[f];}for(f in d){if(f.search('UxFc')!==-1){delete d[f];}}o.push(this.adjustPayload(d));}catch(e){}}var l=b.length;var g=0;this.accountObject={length1:l,count:g,accEntityList:b,oData:o,errorFunction:a};m.update("/"+b[g],o[g],{success:jQuery.proxy(this.successHandler,this,s,p),error:jQuery.proxy(this.errorHandler,this,a,p)});},successHandler:function(s,d){this.accountObject.count=this.accountObject.count+1;if(this.accountObject.count>=this.accountObject.length1){s(d);}else{this.oModel.update("/"+this.accountObject.accEntityList[this.accountObject.count],this.accountObject.oData[this.accountObject.count],{success:jQuery.proxy(this.successHandler,this,s,d),error:jQuery.proxy(this.errorHandler,this,this.accountObject.errorFunction,d)});}},errorHandler:function(e,d){e(d);},adjustPayload:function(d){for(var p in d){if(p.search('_fc')<0){var a=p.toString()+"_fc";if(d[a]===1||d[a]===0){delete d[p];delete d[a];}}}return d;}});});};if(!jQuery.sap.isDeclared('sap.ui.s2p.mm.lib.reuse.accounting.component.controller.AccountAssignmentDetail.controller')){jQuery.sap.declare('sap.ui.s2p.mm.lib.reuse.accounting.component.controller.AccountAssignmentDetail.controller');jQuery.sap.require('sap.ui.core.mvc.Controller');sap.ui.define("sap/ui/s2p/mm/lib/reuse/accounting/component/controller/AccountAssignmentDetail.controller",["sap/ui/core/mvc/Controller","sap/ui/s2p/mm/lib/reuse/accounting/component/util/HelperFunctions"],function(C,H){"use strict";return C.extend("sap.ui.s2p.mm.lib.reuse.accounting.component.controller.AccountAssignmentDetail",{onInit:function(){this.oi18nModel=new sap.ui.model.resource.ResourceModel({bundleName:"sap.ui.s2p.mm.lib.reuse.accounting.messagebundle",bundleLocale:sap.ui.getCore().getConfiguration().getFormatLocale()});this.getView().setModel(this.oi18nModel,"i18n");this.oTextBundle=this.oi18nModel.getResourceBundle();this.oView=this.getView();this.binded=false;this.ownerData=null;this.oModel=null;this.sAccBindingPathEntityType=null;this.accAssignMetadata=[[],[]];this.oSmartForm=this.oView.byId("accAssignSmartForm");if(!this.oSmartForm){this.oSmartForm=sap.ui.getCore().byId("accAssignSmartForm");}this.bAccDetailsAsPopup=null;this.EditMode=null;},_setPopDisplay:function(m){this.bAccDetailsAsPopup=m;},_setEditMode:function(m){this.EditMode=m;},_setBackButtonVisibility:function(m){this.getView().byId("navBack").setVisible(m);},onBeforeRendering:function(){if(this.bAccDetailsAsPopup===false){this._setBackButtonVisibility(false);}if(!this.getOwnerComponent()){this.ownerData=this.ownerData;}else{this.ownerData=this.getOwnerComponent().oComponentData;}this.oModel=this.ownerData.oModel;if(!this.oModel){this.oModel=this.getView().getModel();}if(!this.sAccBindingPathEntityType){this.sAccBindingPathEntityType="/"+this.getOwnerComponent().oComponentData.sAccBindingPathEntityType;}this.oSmartForm.setEntityType(this.ownerData.sAccEntityTypeName);H.setLayoutProperties(this.oView);if(this.accAssignMetadata[0].length===0&&this.accAssignMetadata[1].length===0){this.accAssignMetadata=this.addAccAssignAttributesFromMetaData(this.oModel,this.oView,this.ownerData.sAccEntityTypeName);}this.getView().setModel(this.oModel);this.oSmartForm.setModel(this.oModel);this.oSmartForm.bindElement(this.sAccBindingPathEntityType);this.getView().byId("accAssignSmartForm").setEditable(this.EditMode);},setContextPath:function(b){this.sAccBindingPathEntityType=b;},NavBack:function(e){this.getOwnerComponent().fireEvent("listNavigation",{accountingEvent:e});},setOwnerData:function(o){this.ownerData=o;},addAccAssignAttributesFromMetaData:function(m,v,e){var a=H.getAttributesFromMetadata(m,e);var A=H.getAccAssignAnnotationFromMetadata(m,e,"AccGroup");var o=H.getAccAssignAnnotationFromMetadata(m,e,"SecondGroup");var b=H.getAccAssignAnnotationFromMetadata(m,e,"ThirdGroup");var g=sap.ui.getCore().byId("AccGroup");if(!g){g=v.byId("AccGroup");}H.clearAttributes(g);var G=sap.ui.getCore().byId("SecondGroup");if(!G){G=v.byId("SecondGroup");}H.clearAttributes(G);var c=sap.ui.getCore().byId("ThirdGroup");if(!c){c=v.byId("ThirdGroup");}H.clearAttributes(c);var d=[];var i,j,k;var f,p,t;if(A){if(A.length===0){g.setVisible(false);}for(i=0;i<A.length;i++){t=false;if(A[i].propertyValue){if(A[i].propertyValue[0].path.lastIndexOf("_Text")===-1){p=A[i].propertyValue[0].path;for(f=0;f<A.length;f++){if(A[f].propertyValue[0].path===p+"_Text"){t=true;break;}}if(t===true){this.addAccAssignAttribute(v,g,A[i].propertyValue[0].path,"accAssignGroupElement",t);}else{this.addAccAssignAttribute(v,g,A[i].propertyValue[0].path,"accAssignGroupElement");}d.push(g,A[i].propertyValue[0].path);}}else{for(k=0;k<A[i].length;k++){if(A[i][k].Value.Path.lastIndexOf("_Text")!==A[i][k].Value.Path.length-"_Text".length){this.addAccAssignAttribute(v,g,A[i][k].Value.Path,"accAssignGroupElement");d.push(g,A[i][k].Value.Path);}}}}}else{if(g){g.destroy();}}if(o){if(o.length===0){G.setVisible(false);}for(i=0;i<o.length;i++){if(o[i].propertyValue){this.addAccAssignAttribute(v,G,o[i].propertyValue[0].path,"accAssignGroupElement");d.push(G,o[i].propertyValue[0].path);}else{for(k=0;k<o[i].length;k++){if(o[i][k].Value.Path.lastIndexOf("_Text")!==o[i][k].Value.Path.length-"_Text".length){this.addAccAssignAttribute(v,G,o[i][k].Value.Path,"accAssignGroupElement");d.push(G,o[i][k].Value.Path);}}}}}else{if(G){G.destroy();}}if(b){if(b.length===0){c.setVisible(false);}for(i=0;i<b.length;i++){if(b[i].propertyValue){this.addAccAssignAttribute(v,c,b[i].propertyValue[0].path,"accAssignGroupElement");d.push(c,b[i].propertyValue[0].path);}else{for(k=0;k<b[i].length;k++){if(b[i][k].Value.Path.lastIndexOf("_Text")!==b[i][k].Value.Path.length-"_Text".length){this.addAccAssignAttribute(v,c,b[i][k].Value.Path,"accAssignGroupElement");d.push(c,b[i][k].Value.Path);}}}}}else{if(c){c.destroy();}}return[d];},addAccAssignAttribute:function(v,g,a,G,t){var V=v.getId();var o=new sap.ui.comp.smartform.GroupElement();var s=new sap.ui.comp.smartfield.SmartField({id:V+"_"+G+a,value:"{"+a+"}"});s.attachEvent("change",this.changeAccounting,this);var c=new sap.ui.comp.smartfield.Configuration();c.setDisplayBehaviour("descriptionAndId");s.setConfiguration(c);o.addElement(s);if(this.EditMode===true&&t===true){var S=new sap.ui.comp.smartfield.SmartField({id:V+"_"+G+a+"_Text",value:"{"+a+"_Text}",showLabel:false,editable:false});o.addElement(S);}g.addGroupElement(o);},changeAccounting:function(){this.getView().setBusy(true);var O=this.getView().byId("accAssignSmartForm").getBindingContext().getModel().getData(this.getView().byId("accAssignSmartForm").getBindingContext().getPath());var p;try{delete O.HasDraftEntity;delete O.DraftAdministrativeDataUUID;delete O.IsActiveEntity;delete O.HasActiveEntity;delete O.MultipleAcctAssgmtDistrPercent;delete O.CompanyCode;delete O.CostElement;delete O.PurReqnAcctDraftUUID;delete O.PurReqnDraftUUID;delete O.PurReqnItemDraftUUID;for(p in O)if(typeof(O[p])==="object"){delete O[p];}for(p in O){if(p.search('UxFc')!==-1){delete O[p];}}}catch(e){}this.adjustPayload(O);var m=this.getView().byId("accAssignSmartForm").getBindingContext().getModel();if(m){m.update(this.getView().byId("accAssignSmartForm").getBindingContext().getPath(),O,{"success":jQuery.proxy(this.successHandler,this),"error":jQuery.proxy(this.errorHandler,this)});}else{this.getView().getModel().update(this.getView().byId("accAssignSmartForm").getBindingContext().getPath(),O,{"success":jQuery.proxy(this.successHandler,this),"error":jQuery.proxy(this.errorHandler,this)});}},successHandler:function(){sap.m.MessageToast.show(this.oTextBundle.getText("updateSuccess"));this.getView().byId("accAssignSmartForm").getBindingContext().getModel().refresh();this.getView().setBusy(false);},errorHandler:function(){},adjustPayload:function(d){for(var p in d){if(p.search('_fc')<0){var a=p.toString()+"_fc";if(d[a]===1||d[a]===0){delete d[p];delete d[a];}}}return d;}});});};if(!jQuery.sap.isDeclared('sap.ui.s2p.mm.lib.reuse.accounting.controls.Example')){jQuery.sap.declare('sap.ui.s2p.mm.lib.reuse.accounting.controls.Example');jQuery.sap.require('jquery.sap.global');jQuery.sap.require('sap.ui.core.Control');sap.ui.define("sap/ui/s2p/mm/lib/reuse/accounting/controls/Example",["jquery.sap.global","./../library","sap/ui/core/Control"],function(q,l,C){"use strict";var E=C.extend("sap.ui.s2p.mm.lib.reuse.accounting.controls.Example",{metadata:{library:"sap.ui.s2p.mm.lib.reuse.accounting",properties:{text:{type:"string",group:"Misc",defaultValue:null}},events:{press:{}}}});return E;},true);};
